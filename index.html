<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Knowledge Base Voice Assistant</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .assistant-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      text-align: center;
    }

    .felix {
      position: absolute;
      bottom: 50px;
      width: 110px;
      height: 95px;
      border-radius: 45%;
      border: 3px solid #fff;
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
      animation: breathe-and-jump 3s linear infinite;
      cursor: pointer;
      z-index: 1;
      background: linear-gradient(to bottom, #5fc, #1a8);
    }

    .felix::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      width: calc(100% + 3px);
      height: calc(100% + 2px);
      background: linear-gradient(to bottom, #5fc, #1a8);
      border-radius: 45%;
      opacity: 0;
      transition: 0.3s linear all;
    }

    .felix.active::before {
      opacity: 1;
    }

    .felix > .eyes {
      position: relative;
    }

    .felix > .eyes > .eye {
      position: absolute;
      top: 20px;
      width: 20px;
      height: 25px;
      border-radius: 15px;
      background-color: #fff;
      box-shadow: 0 0 7px rgba(255, 255, 255, 0.5);
      animation: blink 5s linear infinite;
    }

    .felix > .eyes > .eye.left { left: 25%; }
    .felix > .eyes > .eye.right { right: 25%; }

    .response-frame, .caption-frame, .suggestions-frame {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #000c;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s linear;
      color: #fff;
    }

    .response-frame.active, .caption-frame.active, .suggestions-frame.active {
      z-index: 1000;
      opacity: 1;
    }

    .response-frame > .lead, .caption-frame > .caption {
      padding: 10px;
      border-radius: 5px;
      background-color: #333;
    }

    .suggestions-frame {
      flex-direction: column;
      align-items: center;
    }

    .suggestions-frame > .suggestions {
      max-height: 50%;
      overflow-y: auto;
      width: 100%;
      background-color: #222;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .suggestions-frame > .suggestions > button {
      background: #333;
      border: none;
      color: #e0e0e0;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      text-align: left;
      font-size: 18px;
    }

    .suggestions-frame > .suggestions > button:hover {
      background: #444;
    }

    @keyframes blink {
      0%, 100% { transform: scale(1, 0.05); }
      5%, 95% { transform: scale(1, 1); }
    }

    @keyframes breathe-and-jump {
      0%, 40%, 80%, 100% { height: 95px; transform: translateY(0); }
      20%, 60%, 70%, 90% { height: 100px; transform: translateY(-5px); }
    }
  </style>
</head>
<body>
  <div class="assistant-container">
    <div id="felix" class="felix">
      <div class="eyes">
        <div class="eye left"></div>
        <div class="eye right"></div>
      </div>
    </div>
    <div class="response-frame">
      <div class="lead">Processing...</div>
    </div>
    <div class="caption-frame">
      <div class="caption">Say something...</div>
    </div>
    <div class="suggestions-frame">
      <div class="suggestions"></div>
    </div>
  </div>

  <script>
    if (!('webkitSpeechRecognition' in window) || !('speechSynthesis' in window)) {
      alert('Speech recognition or synthesis not supported in this browser.');
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    const synthesis = window.speechSynthesis;
    const felix = document.getElementById('felix');
    const responseFrame = document.querySelector('.response-frame');
    const captionFrame = document.querySelector('.caption-frame');
    const suggestionsFrame = document.querySelector('.suggestions-frame');
    const suggestionsContainer = suggestionsFrame.querySelector('.suggestions');

    recognition.interimResults = true;
    recognition.lang = 'en-US';
    recognition.continuous = true;

    let isListening = false;
    let currentCommand = '';
    let silenceTimeout;

    // Custom knowledge base based on the site
    const responses = {
      about: 'We are a company dedicated to providing innovative solutions. For more details, visit our website.',
      services: 'We offer a range of services including web development, mobile app development, and digital marketing.',
      contact: 'You can contact us through our website\'s contact form or email us at contact@rammijar.com.np.',
      support: 'For support, please visit our support page or email us directly.',
      faq: 'Frequently asked questions are available on our FAQ page.',
      noInput: 'I didnâ€™t hear anything. Can you please repeat?',
    };

    function getRandomResponse(responses) {
      const keys = Object.keys(responses);
      return responses[keys[Math.floor(Math.random() * keys.length)]];
    }

    function handleVoiceCommand(command) {
      let responseText = responses.noInput;

      if (command.includes('about')) {
        responseText = responses.about;
      } else if (command.includes('services')) {
        responseText = responses.services;
      } else if (command.includes('contact')) {
        responseText = responses.contact;
      } else if (command.includes('support')) {
        responseText = responses.support;
      } else if (command.includes('faq')) {
        responseText = responses.faq;
      }

      return responseText;
    }

    function updateCaption(text) {
      captionFrame.querySelector('.caption').textContent = text;
      captionFrame.classList.add('active');
    }

    function updateSuggestions(commands) {
      suggestionsContainer.innerHTML = '';
      commands.forEach(command => {
        const button = document.createElement('button');
        button.textContent = command;
        button.onclick = () => {
          processCommand(command.toLowerCase());
        };
        suggestionsContainer.appendChild(button);
      });
      suggestionsFrame.classList.add('active');
    }

    function processCommand(command) {
      let responseText = handleVoiceCommand(command);

      updateCaption(`You said: ${command}`);
      responseFrame.querySelector('.lead').textContent = 'Processing...';

      if (synthesis.speaking) {
        synthesis.cancel(); // Stop current speech if any
      }

      const utterance = new SpeechSynthesisUtterance(responseText);
      synthesis.speak(utterance);

      responseFrame.classList.add('active');

      utterance.onend = () => {
        responseFrame.classList.remove('active');
        captionFrame.classList.remove('active');
        suggestionsFrame.classList.remove('active');
        startListening(); // Restart listening after response
      };

      clearTimeout(silenceTimeout);
    }

    function handleNoInput() {
      updateCaption(responses.noInput);
      responseFrame.querySelector('.lead').textContent = 'Processing...';
      const utterance = new SpeechSynthesisUtterance(responses.noInput);
      synthesis.speak(utterance);
      responseFrame.classList.add('active');
      utterance.onend = () => {
        responseFrame.classList.remove('active');
        captionFrame.classList.remove('active');
        suggestionsFrame.classList.remove('active');
        startListening(); // Restart listening after response
      };
    }

    function startListening() {
      if (isListening) return;

      isListening = true;
      recognition.start();
      felix.classList.add('active');
      captionFrame.classList.remove('active');
      suggestionsFrame.classList.remove('active');

      updateCaption('Listening...');
      recognition.onresult = (event) => {
        let transcript = '';
        for (const result of event.results) {
          transcript += result[0].transcript;
        }
        currentCommand = transcript.toLowerCase();
        updateSuggestions([
          'About Us',
          'Services',
          'Contact',
          'Support',
          'FAQ'
        ]);

        if (event.results[0].isFinal) {
          processCommand(currentCommand);
          isListening = false;
        }
      };

      recognition.onspeechend = () => {
        clearTimeout(silenceTimeout);
        silenceTimeout = setTimeout(() => {
          recognition.stop();
          isListening = false;
          handleNoInput(); // Handle no input case
        }, 1000);
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        startListening(); // Restart listening on error
      };
    }

    function deactivateAssistant() {
      felix.classList.remove('active');
      isListening = false;
      recognition.stop();
    }

    // Initial setup
    startListening();
  </script>
</body>
</html>
